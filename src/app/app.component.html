<h2>Ogame Easy Raids</h2>
<div class="univers-url">
	<form>
		<div>
			<mat-form-field appearance="fill" color="accent">
				<mat-label>Univers URL</mat-label>
				<input
					placeholder="Ex: https://s172-fr.ogame.gameforge.com"
					matInput
					name="universUrl"
					type="text"
					(input)="setUniversUrlStorage($event.target.value)"
					[(ngModel)]="universUrl"
					[pattern]="urlRegex"
				/>
				<mat-error *ngIf="universUrl && !urlIsValid()">
					Invalid URL
				</mat-error>
			</mat-form-field>
			<div class="url-help">
				<mat-icon>help_outline</mat-icon>
				<img src="./assets/url.png" />
			</div>
		</div>
	</form>
</div>

<div class="has-univers-url" [@slide]="universUrl && urlIsValid() ? 'opened' : 'closed'">
	<mat-card>
		<mat-card-header
			class="text-card"
			matRipple
			[matRippleUnbounded]="false"
			(click)="state = state === 'closed' ? 'opened' : 'closed'"
		>
			<h4>Information</h4>
			<button mat-icon-button>
				<mat-icon [class.icon-closed]="state === 'closed'">
					expand_less
				</mat-icon>
			</button>
		</mat-card-header>
		<div class="animated-content" [@slide]="state">
			<mat-card-content>
				<div class="extra-info">
					<mat-form-field appearance="fill" color="accent">
						<mat-label>Technologie Hyperespace</mat-label>
						<input
							matInput
							type="number"
							(input)="setTechStorage($event.target.value)"
							[(ngModel)]="techLvl"
						/>
					</mat-form-field>
					<mat-checkbox [(ngModel)]="isCollector" (change)="setIsCollectorStorage($event.checked)">
						Classe "Le Collecteur"
					</mat-checkbox>
				</div>
				<mat-form-field appearance="fill" color="accent">
					<mat-label>Rapports d'espionnage</mat-label>
					<textarea [(ngModel)]="rawData" matInput rows="15" (keydown.enter)="process(); (false)"></textarea>
				</mat-form-field>
				<div>Capacité grand transporteur: {{ getCargoCapacity().toLocaleString("fr-BE") }}</div>
			</mat-card-content>
		</div>

		<button
			class="add-button"
			[disabled]="!rawData || rawData.trim().length === 0"
			mat-fab
			color="accent"
			(click)="process()"
			*ngIf="state === 'opened'"
		>
			<mat-icon>add</mat-icon>
		</button>
	</mat-card>

	<mat-card class="table-card">
		<div class="toolbar">
			<button color="accent" mat-stroked-button (click)="resetFilter()">Retirer les filtres</button>
			<button color="accent" mat-stroked-button (click)="clearFleet()">Masquer rapport avec flottes</button>
			<button color="accent" mat-stroked-button (click)="clearDefense()">Masquer rapport avec défenses</button>
			<button color="accent" mat-stroked-button (click)="clearBoth()">Masquer les deux</button>
		</div>
		<table mat-table [dataSource]="dataSource" matSort>
			<!--- Note that these columns can be defined in any order.
					  The actual rendered columns are set as a property on the row definition" -->

			<!-- Index Column -->
			<ng-container matColumnDef="index">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>
					No.
				</th>
				<td mat-cell *matCellDef="let element; let i = index">
					{{ i + 1 }}
				</td>
			</ng-container>

			<!-- Resources Column -->
			<ng-container matColumnDef="resources">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>
					Resources
				</th>
				<td mat-cell *matCellDef="let element">
					{{ (element.resources | number | pointReplacer) || "??" }}
				</td>
			</ng-container>

			<!-- Flottes Column -->
			<ng-container matColumnDef="flottes">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>
					Flottes
				</th>
				<td mat-cell *matCellDef="let element">
					<span
						[class.warn]="element.flottes > 0"
						[class.unknown]="element.flottes === null"
						[class.danger]="element.flottes > 1000000"
					>
						{{ (element.flottes | number | pointReplacer) || "??" }}
					</span>
				</td>
			</ng-container>

			<!-- Defenses Column -->
			<ng-container matColumnDef="defenses">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>
					Defenses
				</th>
				<td mat-cell *matCellDef="let element">
					<span
						[class.warn]="element.defenses > 0"
						[class.unknown]="element.defenses === null"
						[class.danger]="element.defenses > 1000000"
					>
						{{ (element.defenses | number | pointReplacer) || "??" }}
					</span>
				</td>
			</ng-container>

			<!-- Cargo Column -->
			<ng-container matColumnDef="noCargo">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>
					Cargos
				</th>
				<td mat-cell *matCellDef="let element">
					{{ element.noCargo }}
				</td>
			</ng-container>

			<!-- Coords Column -->
			<ng-container matColumnDef="coordinates">
				<th mat-header-cell *matHeaderCellDef>
					Coord.
				</th>
				<td mat-cell *matCellDef="let element">
					<span (click)="navigate(element)" class="coords">
						{{ element.coordinates.toString() }}
					</span>
				</td>
			</ng-container>

			<!-- Activity Column -->
			<ng-container matColumnDef="activity">
				<th mat-header-cell *matHeaderCellDef>
					Activity
				</th>
				<td mat-cell *matCellDef="let element">
					<span
						[class.unknown]="element.activity < 60"
						[class.warn]="element.activity < 45"
						[class.danger]="element.activity === 15"
					>
						{{ element.activity }}
					</span>
				</td>
			</ng-container>

			<ng-container matColumnDef="actions">
				<th mat-header-cell *matHeaderCellDef></th>
				<td mat-cell *matCellDef="let element">
					<button mat-icon-button (click)="remove(element)">
						<mat-icon>clear</mat-icon>
					</button>
					<button mat-icon-button (click)="browse(element)">
						<mat-icon>search</mat-icon>
					</button>
				</td>
			</ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
			<tr
				mat-row
				*matRowDef="let row; columns: displayedColumns"
				[class.focused]="lastElementClicked === row"
			></tr>
		</table>
	</mat-card>
</div>
